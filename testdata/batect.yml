containers:
    jobaggrv-api:
        build_args:
            GIT_COMMIT: cdc3b19
        build_directory: .
        dependencies:
            - jobaggrv-scrapy
        dockerfile: ./Dockerfile
        entrypoint: gunicorn --worker-class gevent -w 4 --worker-connections 1000 -b 0.0.0.0:8000 jobaggrv_api.app:app
        log_driver: syslog
        log_options:
            syslog-address: tcp://192.168.0.42:123
        ports:
            - 8000:8000
    jobaggrv-mysql:
        additional_hosts:
            otherhost: 50.31.209.229
            somehost: 162.242.195.82
        capabilities_to_add:
            - ALL
        capabilities_to_drop:
            - NET_ADMIN
            - SYS_ADMIN
        environment:
            MYSQL_DATABASE: jobaggrv
            MYSQL_PASSWORD: jobaggrv
            MYSQL_ROOT_PASSWORD: jobaggrv
            MYSQL_USER: jobaggrv
        health_check:
            command: CMD curl -f http://localhost
            retries: 3
            interval: 1m30s
            start_period: 40s
            timeout: 10s
        image: mysql:8-debian
        ports:
            - 33060:3306
    jobaggrv-scrapy:
        build_args:
            GIT_COMMIT: cdc3b19
        build_directory: .
        build_target: prod
        command: echo I'm running ${COMPOSE_PROJECT_NAME}
        devices:
            - /dev/ttyUSB0:/dev/ttyUSB0
            - /dev/sda:/dev/xvda:rwm
        dockerfile: ./Dockerfile
        enable_init_process: true
        shm_size: "1048576"
        working_directory: /opt
